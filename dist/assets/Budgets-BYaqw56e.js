import{j as e}from"./chart-vendor-Bh8T1N6h.js";import{r as t}from"./react-vendor-Ds2lu_e3.js";import{u as I,b as c,z as o,d as k}from"./index-D8iPbbyk.js";import{f}from"./formatters-Dsd9xoBe.js";import{M}from"./Modal-sr4I0w_v.js";import{P as O,T as E}from"./trash-2-FLo-CoGg.js";import{P}from"./pen-square-CW-Z5GoV.js";function T(){const{user:l}=I(),[g,y]=t.useState([]),[v,N]=t.useState([]),[b,p]=t.useState(!0),[w,h]=t.useState(!1),[d,j]=t.useState(null),[r,n]=t.useState({categoryId:"",value:"",period:"Mensal"});t.useEffect(()=>{l&&m()},[l]);const m=async()=>{p(!0);try{const[a,s]=await Promise.all([c.get(`/budgets?userId=${l.id}`),c.get(`/categories?userId=${l.id}`)]);a.success&&y(a.data||[]),s.success&&N(s.data||[])}catch{o.error("Erro ao carregar orçamentos")}finally{p(!1)}},C=async a=>{a.preventDefault();try{const s={categoryId:parseInt(r.categoryId),value:parseFloat(r.value),period:r.period,userId:l.id};d?(await c.put(`/budgets/${d.idOrcamento}`,s)).success&&(o.success("Orçamento atualizado!"),m(),u()):(await c.post("/budgets",s)).success&&(o.success("Orçamento criado!"),m(),u())}catch(s){o.error(s.message||"Erro ao salvar orçamento")}},S=async a=>{if(confirm("Tem certeza que deseja excluir este orçamento?"))try{(await c.delete(`/budgets/${a}?userId=${l.id}`)).success&&(o.success("Orçamento excluído!"),m())}catch{o.error("Erro ao excluir orçamento")}},u=()=>{h(!1),j(null),n({categoryId:"",value:"",period:"Mensal"})};return b?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-600 border-t-transparent"})}):e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Orçamentos"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Controle seus gastos planejados"})]}),e.jsxs("button",{onClick:()=>h(!0),className:"btn-primary",children:[e.jsx(O,{className:"w-4 h-4"}),"Novo Orçamento"]})]}),g.length===0?e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(k,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Nenhum orçamento definido"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:g.map(a=>{const s=a.valorUsado||0,i=a.valorPlanejado||0,x=i>0?Math.min(s/i*100,100):0;return e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:a.categoryName}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:a.periodo}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[f(s)," / ",f(i)]}),e.jsxs("span",{className:"font-semibold",children:[x.toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${x>100?"bg-red-500":x>80?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(x,100)}%`}})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{j(a),n({categoryId:a.idCategoria.toString(),value:a.valorPlanejado.toString(),period:a.periodo}),h(!0)},className:"btn-secondary flex-1",children:[e.jsx(P,{className:"w-4 h-4"}),"Editar"]}),e.jsxs("button",{onClick:()=>S(a.idOrcamento),className:"btn-danger flex-1",children:[e.jsx(E,{className:"w-4 h-4"}),"Excluir"]})]})]},a.idOrcamento)})}),e.jsx(M,{isOpen:w,onClose:u,title:d?"Editar Orçamento":"Novo Orçamento",children:e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Categoria"}),e.jsxs("select",{value:r.categoryId,onChange:a=>n({...r,categoryId:a.target.value}),className:"input",required:!0,children:[e.jsx("option",{value:"",children:"Selecione a categoria"}),v.map(a=>e.jsx("option",{value:a.idCategoria,children:a.nome},a.idCategoria))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Valor Planejado (R$)"}),e.jsx("input",{type:"number",step:"0.01",value:r.value,onChange:a=>n({...r,value:a.target.value}),className:"input",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Período"}),e.jsxs("select",{value:r.period,onChange:a=>n({...r,period:a.target.value}),className:"input",required:!0,children:[e.jsx("option",{value:"Mensal",children:"Mensal"}),e.jsx("option",{value:"Anual",children:"Anual"})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{type:"button",onClick:u,className:"btn-secondary",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn-primary",children:d?"Atualizar":"Criar"})]})]})})]})}export{T as default};
