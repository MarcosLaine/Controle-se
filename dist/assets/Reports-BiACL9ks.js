import{j as e,D as y,d as $,C as R,A as L,p as O,a as F,b as P,L as _,B as U,c as G}from"./chart-vendor-Bh8T1N6h.js";import{r as i}from"./react-vendor-Ds2lu_e3.js";import{u as I,b as M,z as u,F as T}from"./index-D8iPbbyk.js";import{f as n,a as g}from"./formatters-Dsd9xoBe.js";import{S as b}from"./SummaryCard-CVxJGsjw.js";import{D as z}from"./download-Mx-G8u78.js";import{A as B,a as J}from"./arrow-up-D6-4z40S.js";import{S as X}from"./scale-sdIhPVkq.js";R.register(L,O,F,P,_,U,G);function ee(){const{user:c}=I(),[v,f]=i.useState(!0),[o,N]=i.useState("month"),[r,w]=i.useState(""),[l,k]=i.useState(""),[t,E]=i.useState(null),[x,A]=i.useState("csv");i.useEffect(()=>{c&&(o!=="custom"||r&&l)&&C()},[c,o,r,l]);const C=async()=>{if(c){f(!0);try{let a=`/reports?userId=${c.id}&period=${o}`;o==="custom"&&r&&l&&(a+=`&startDate=${r}&endDate=${l}`);const s=await M.get(a);s.success?E(s.data):u.error("Erro ao carregar relatórios")}catch(a){console.error("Erro ao carregar relatórios:",a),u.error("Erro ao carregar relatórios")}finally{f(!1)}}},D=async()=>{if(c)try{const a={userId:c.id,format:x,period:o==="custom"?"custom":o};o==="custom"&&r&&l&&(a.startDate=r,a.endDate=l);const s=window.location.hostname==="localhost"?"http://localhost:8080/api":`${window.location.origin}/api`,d=await fetch(`${s}/reports`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(d.ok){const S=await d.blob(),j=window.URL.createObjectURL(S),m=document.createElement("a");m.href=j,m.download=`relatorio_${r||"inicio"}_${l||"fim"}.${x}`,document.body.appendChild(m),m.click(),window.URL.revokeObjectURL(j),document.body.removeChild(m),u.success("Relatório exportado com sucesso!")}else u.error("Erro ao exportar relatório")}catch(a){console.error("Erro ao exportar:",a),u.error("Erro ao exportar relatório")}};if(v)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-600 border-t-transparent"})});const h=t!=null&&t.categoryAnalysis?Object.entries(t.categoryAnalysis).map(([a,s])=>({name:a,total:s})):[],p=(t==null?void 0:t.monthlyAnalysis)||[];return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Relatórios"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Análise detalhada das suas finanças"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("select",{value:o,onChange:a=>N(a.target.value),className:"input w-full sm:w-auto",children:[e.jsx("option",{value:"month",children:"Este Mês"}),e.jsx("option",{value:"year",children:"Este Ano"}),e.jsx("option",{value:"custom",children:"Período Personalizado"})]}),o==="custom"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"date",value:r,onChange:a=>w(a.target.value),className:"input w-full sm:w-auto",placeholder:"Data Início"}),e.jsx("input",{type:"date",value:l,onChange:a=>k(a.target.value),className:"input w-full sm:w-auto",placeholder:"Data Fim"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:x,onChange:a=>A(a.target.value),className:"input w-full sm:w-auto",children:[e.jsx("option",{value:"csv",children:"CSV"}),e.jsx("option",{value:"xlsx",children:"XLSX"})]}),e.jsxs("button",{onClick:D,className:"btn-primary flex-1 sm:flex-none justify-center",children:[e.jsx(z,{className:"w-4 h-4"}),"Exportar"]})]})]})]}),t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(b,{title:"Total de Receitas",amount:n(t.totalIncomes||0),icon:B,type:"income",subtitle:`${t.incomeCount||0} transações`}),e.jsx(b,{title:"Total de Gastos",amount:n(t.totalExpenses||0),icon:J,type:"expense",subtitle:`${t.expenseCount||0} transações`}),e.jsx(b,{title:"Saldo do Período",amount:n(t.balance||0),icon:X,type:"balance",subtitle:t.startDate&&t.endDate?`${g(t.startDate)} a ${g(t.endDate)}`:"Período selecionado"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[h.length>0&&e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Gastos por Categoria"}),e.jsx("div",{className:"h-64",children:e.jsx(y,{data:{labels:h.map(a=>a.name),datasets:[{data:h.map(a=>a.total),backgroundColor:["#ef4444","#f59e0b","#3b82f6","#8b5cf6","#ec4899","#14b8a6","#f97316","#6366f1"]}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{padding:15,usePointStyle:!0,color:"#6b7280"}},tooltip:{callbacks:{label:a=>{const s=a.label||"",d=n(a.parsed);return`${s}: ${d}`}}}}}})})]}),p.length>0&&e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Evolução Mensal"}),e.jsx("div",{className:"h-64",children:e.jsx($,{data:{labels:p.map(a=>`${["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"][a.month-1]}/${a.year}`),datasets:[{label:"Receitas",data:p.map(a=>a.incomes||0),backgroundColor:"#22c55e"},{label:"Gastos",data:p.map(a=>a.expenses||0),backgroundColor:"#ef4444"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"},tooltip:{callbacks:{label:a=>`${a.dataset.label}: ${n(a.parsed.y)}`}}},scales:{y:{beginAtZero:!0,ticks:{callback:a=>n(a)}}}}})})]})]}),t.accountAnalysis&&Object.keys(t.accountAnalysis).length>0&&e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Gastos por Conta"}),e.jsx("div",{className:"h-64",children:e.jsx(y,{data:{labels:Object.keys(t.accountAnalysis),datasets:[{data:Object.values(t.accountAnalysis),backgroundColor:["#3b82f6","#8b5cf6","#ec4899","#14b8a6","#f97316"]}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"},tooltip:{callbacks:{label:a=>{const s=a.label||"",d=n(a.parsed);return`${s}: ${d}`}}}}}})})]}),t.topExpenses&&t.topExpenses.length>0&&e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Maiores Gastos"}),e.jsx("div",{className:"space-y-3",children:t.topExpenses.map((a,s)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:a.description}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[g(a.date)," - ",a.category]})]}),e.jsx("p",{className:"text-lg font-bold text-red-600 dark:text-red-400",children:n(a.value||0)})]},s))})]})]}):e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(T,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Nenhum dado disponível para o período selecionado"})]})]})}export{ee as default};
