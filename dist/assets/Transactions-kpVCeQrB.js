import{j as e}from"./chart-vendor-Bh8T1N6h.js";import{r as d}from"./react-vendor-Ds2lu_e3.js";import{c as R,u as A,a as F,b as h,z as p}from"./index-Bxg-l_Jj.js";import{a as q,f as O}from"./formatters-Dsd9xoBe.js";import{M as G}from"./Modal-CbvRRIwR.js";import{P as L,T as z}from"./trash-2-CF_gXZbT.js";import{F as P}from"./filter-qI5jwF8q.js";import{A as U,a as V}from"./arrow-up-D6WpHf8e.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=R("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);function _(){const{user:r}=A(),{invalidateCache:l}=F(),[m,C]=d.useState([]),[k,v]=d.useState(!0),[S,b]=d.useState(!1),[t,c]=d.useState(!1),[j,a]=d.useState([]),[i,x]=d.useState([]),[N,D]=d.useState([]),[n,w]=d.useState({category:"",tag:"",date:""});d.useEffect(()=>{r&&I()},[r,n]);const I=async()=>{v(!0);try{const[s,o,u,T]=await Promise.all([h.get(`/transactions?userId=${r.id}`),h.get(`/categories?userId=${r.id}`),h.get(`/accounts?userId=${r.id}`),h.get(`/tags?userId=${r.id}`)]);if(s.success){let g=s.data||[];n.category&&(g=g.filter(f=>f.categoryId===parseInt(n.category))),n.tag&&(g=g.filter(f=>{var y;return(y=f.tags)==null?void 0:y.some(E=>E.idTag===parseInt(n.tag))})),n.date&&(g=g.filter(f=>{var y;return(y=f.date)==null?void 0:y.startsWith(n.date)})),C(g)}o.success&&a(o.data||[]),u.success&&x(u.data||[]),T.success&&D(T.data||[])}catch{p.error("Erro ao carregar transações")}finally{v(!1)}},M=async(s,o)=>{if(confirm("Tem certeza que deseja excluir esta transação?"))try{const u=o==="income"?"/incomes":"/expenses";(await h.delete(`${u}?id=${s}`)).success&&(p.success("Transação excluída!"),l(`overview-${r.id}-month`),l(`overview-${r.id}-year`),l(`overview-${r.id}-all`),l(`recent-transactions-${r.id}`),I())}catch{p.error("Erro ao excluir transação")}};return k?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary-600 border-t-transparent"})}):e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Transações"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Gerencie suas receitas e gastos"})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs("button",{onClick:()=>b(!0),className:"flex-1 sm:flex-none btn-secondary justify-center",children:[e.jsx(W,{className:"w-4 h-4"}),"Novo Gasto"]}),e.jsxs("button",{onClick:()=>c(!0),className:"flex-1 sm:flex-none btn-primary justify-center",children:[e.jsx(L,{className:"w-4 h-4"}),"Nova Receita"]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(P,{className:"w-5 h-5 text-gray-500"}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Filtros"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Categoria"}),e.jsxs("select",{value:n.category,onChange:s=>w({...n,category:s.target.value}),className:"input",children:[e.jsx("option",{value:"",children:"Todas as Categorias"}),j.map(s=>e.jsx("option",{value:s.idCategoria,children:s.nome},s.idCategoria))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Tag"}),e.jsxs("select",{value:n.tag,onChange:s=>w({...n,tag:s.target.value}),className:"input",children:[e.jsx("option",{value:"",children:"Todas as Tags"}),N.map(s=>e.jsx("option",{value:s.idTag,children:s.nome},s.idTag))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Data"}),e.jsx("input",{type:"date",value:n.date,onChange:s=>w({...n,date:s.target.value}),className:"input"})]})]}),e.jsx("button",{onClick:()=>w({category:"",tag:"",date:""}),className:"btn-secondary mt-4",children:"Limpar Filtros"})]}),m.length===0?e.jsx("div",{className:"card text-center py-12",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Nenhuma transação encontrada"})}):e.jsx("div",{className:"space-y-3",children:m.map(s=>e.jsxs("div",{className:"card flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 w-full sm:w-auto",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center shrink-0 ${s.type==="income"?"bg-green-100 dark:bg-green-900/30 text-green-600":"bg-red-100 dark:bg-red-900/30 text-red-600"}`,children:s.type==="income"?e.jsx(U,{className:"w-6 h-6"}):e.jsx(V,{className:"w-6 h-6"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white truncate",children:s.description}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:[q(s.date)," - ",s.category]}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:s.tags.map(o=>e.jsx("span",{className:"text-xs px-2 py-1 rounded-full text-white",style:{backgroundColor:o.cor},children:o.nome},o.idTag))}),s.observacoes&&s.observacoes.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 font-medium",children:"Observações:"}),e.jsx("ul",{className:"text-xs text-gray-600 dark:text-gray-300 list-disc list-inside mt-1",children:Array.isArray(s.observacoes)?s.observacoes.map((o,u)=>e.jsx("li",{children:o},u)):e.jsx("li",{children:s.observacoes})})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between sm:justify-end gap-4 w-full sm:w-auto border-t sm:border-t-0 pt-4 sm:pt-0 border-gray-100 dark:border-gray-700",children:[e.jsxs("span",{className:`text-lg font-bold ${s.type==="income"?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[s.type==="income"?"+":"-",O(s.value||0)]}),e.jsx("button",{onClick:()=>M(s.id,s.type),className:"btn-danger shrink-0",children:e.jsx(z,{className:"w-4 h-4"})})]})]},s.id))}),e.jsx($,{isOpen:S,onClose:()=>b(!1),type:"expense",categories:j,accounts:i,tags:N,onSuccess:()=>{I(),l(`overview-${r.id}-month`),l(`overview-${r.id}-year`),l(`overview-${r.id}-all`),l(`recent-transactions-${r.id}`)},user:r}),e.jsx($,{isOpen:t,onClose:()=>c(!1),type:"income",categories:j,accounts:i,tags:N,onSuccess:()=>{I(),l(`overview-${r.id}-month`),l(`overview-${r.id}-year`),l(`overview-${r.id}-all`),l(`recent-transactions-${r.id}`)},user:r})]})}function $({isOpen:r,onClose:l,type:m,categories:C,accounts:k,tags:v,onSuccess:S,user:b}){const[t,c]=d.useState({description:"",value:"",date:new Date().toISOString().split("T")[0],accountId:"",categoryIds:[],tagIds:[],observacoes:""}),j=async a=>{a.preventDefault();try{const i={description:t.description,value:parseFloat(t.value),date:t.date,accountId:parseInt(t.accountId),userId:b.id};if(m==="expense"&&(i.categoryIds=t.categoryIds.map(Number),i.categoryIds.length===0)){p.error("Selecione pelo menos uma categoria");return}t.tagIds.length>0&&(i.tagIds=t.tagIds.map(Number)),t.observacoes&&t.observacoes.trim()&&(i.observacoes=t.observacoes.trim());const x=m==="expense"?"/expenses":"/incomes";(await h.post(x,i)).success&&(p.success(`${m==="expense"?"Gasto":"Receita"} adicionada!`),S(),l(),c({description:"",value:"",date:new Date().toISOString().split("T")[0],accountId:"",categoryIds:[],tagIds:[],observacoes:""}))}catch(i){p.error(i.message||"Erro ao salvar transação")}};return e.jsx(G,{isOpen:r,onClose:l,title:m==="expense"?"Novo Gasto":"Nova Receita",children:e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Descrição"}),e.jsx("input",{type:"text",value:t.description,onChange:a=>c({...t,description:a.target.value}),className:"input",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Valor"}),e.jsx("input",{type:"number",step:"0.01",value:t.value,onChange:a=>c({...t,value:a.target.value}),className:"input",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Data"}),e.jsx("input",{type:"date",value:t.date,onChange:a=>c({...t,date:a.target.value}),className:"input",required:!0})]}),m==="expense"&&e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Categorias"}),e.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:C.map(a=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.categoryIds.includes(a.idCategoria.toString()),onChange:i=>{i.target.checked?c({...t,categoryIds:[...t.categoryIds,a.idCategoria.toString()]}):c({...t,categoryIds:t.categoryIds.filter(x=>x!==a.idCategoria.toString())})}}),e.jsx("span",{children:a.nome})]},a.idCategoria))})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"label",children:"Conta"}),e.jsxs("select",{value:t.accountId,onChange:a=>c({...t,accountId:a.target.value}),className:"input",required:!0,children:[e.jsx("option",{value:"",children:"Selecione a conta"}),k.filter(a=>{var i;return((i=a.tipo)==null?void 0:i.toLowerCase())!=="investimento"}).map(a=>e.jsxs("option",{value:a.idConta,children:[a.nome," (",a.tipo,")"]},a.idConta))]})]}),v.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Tags (opcional)"}),e.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:v.map(a=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.tagIds.includes(a.idTag.toString()),onChange:i=>{i.target.checked?c({...t,tagIds:[...t.tagIds,a.idTag.toString()]}):c({...t,tagIds:t.tagIds.filter(x=>x!==a.idTag.toString())})}}),e.jsx("span",{className:"text-xs px-2 py-1 rounded-full text-white",style:{backgroundColor:a.cor},children:a.nome})]},a.idTag))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Observações (opcional)"}),e.jsx("textarea",{value:t.observacoes,onChange:a=>c({...t,observacoes:a.target.value}),className:"input",rows:"3",placeholder:"Digite observações separadas por vírgula ou quebra de linha..."})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{type:"button",onClick:l,className:"btn-secondary",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn-primary",children:"Salvar"})]})]})})}export{_ as default};
